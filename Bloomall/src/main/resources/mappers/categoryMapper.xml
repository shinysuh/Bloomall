<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="com.bloomall.mappers.CategoryMapper">

	<!-- 카테고리 등록 -->
	<insert id="register" parameterType="CategoryVO">
		insert into category_tb(ctgr_cd, ctgr_prt_cd, ctgr_name)
        values(#{ctgr_cd}, #{ctgr_prt_cd}, #{ctgr_name})
	</insert>
	
	
	<!-- 카테고리 관리(리스트) -->
	<select id="ctgrList" resultType="CategoryVO" parameterType="SearchCriteria">
		select ctgr_cd, ctgr_prt_cd, ctgr_name 
		from (select ctgr_cd, ctgr_prt_cd, ctgr_name,
					 row_number() over(order by ctgr_cd desc) ct_seq
		      from category_tb
			  <include refid="search" />
		      )
		where ct_seq between #{rowStart} and #{rowEnd}
	</select>
	
	<!-- 카테고리 검색 쿼리 -->
	<sql id="search">
		<if test="searchType != null">
			<if test="searchType == 'sec_ct'.toString()">
				where ctgr_cd like '%'||#{keyword}||'%'
			</if>	
			<if test="searchType == 'prime_ct'.toString()">
				where ctgr_prt_cd like '%'||#{keyword}||'%'
			</if>	
			<if test="searchType == 'c_name'.toString()">
				where ctgr_name like '%'||#{keyword}||'%'
			</if>	
			<if test="searchType == 'anything'.toString()">
				where (ctgr_cd like '%'||#{keyword}||'%')
				OR (ctgr_prt_cd like '%'||#{keyword}||'%')
				OR (ctgr_name like '%'||#{keyword}||'%')
			</if>	
		</if>
	</sql>
	
	
	<!-- 카테고리 개수 -->
	<select id="ctgrTotalCount" resultType="int" parameterType="SearchCriteria">
		select count(ctgr_cd) from category_tb
		<include refid="search" /> 
	</select>
	
	
	<!-- 카테고리 수정 -->
	<update id="ctgrUpdate" parameterType="CategoryVO">
		update category_tb
		set ctgr_cd=#{ctgr_cd}, ctgr_prt_cd=#{ctgr_prt_cd}, ctgr_name=#{ctgr_name}
		where ctgr_cd=#{ctgr_cd}
	</update>
	
	
	<!-- 카테고리 삭제 -->
	<delete id="ctgrDelete" parameterType="String">
		delete from category_tb
		where ctgr_cd=#{ctgr_cd}
	</delete>

</mapper>